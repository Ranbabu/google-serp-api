<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ImageSearchMan — Images & Short Clips</title>
<meta name="description" content="ImageSearchMan - DuckDuckGo images (via proxy) + quick video preview. Mobile-first app-like UI." />
<style>
  :root{
    --bg:#f2fbfb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#072b2a;
    --primary:#06b6d4;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Roboto,Arial;color:var(--accent)}
  body{background:linear-gradient(180deg,#f7fbfc,#eef7f9);}

  .frame{display:flex;flex-direction:column;height:100vh;}
  header.appbar{
    position:fixed;top:0;left:0;right:0;padding:12px 14px;height:72px;
    background:rgba(255,255,255,0.85);backdrop-filter:blur(8px);
    border-bottom:1px solid rgba(7,43,42,0.06);
    display:flex;align-items:center;gap:12px;z-index:20;
  }
  .logo{width:46px;height:46px;background:var(--primary);color:white;border-radius:10px;
    display:grid;place-items:center;font-weight:800;font-size:17px}
  .app-title{font-weight:800;font-size:17px}
  .app-sub{font-size:12px;color:var(--muted)}

  main.content{flex:1;margin-top:72px;margin-bottom:80px;overflow:auto;padding:14px;}

  /* Search Card */
  .hero{max-width:900px;margin:auto;background:var(--card);padding:14px;border-radius:14px;
    border:1px solid rgba(7,43,42,0.06);box-shadow:0 8px 22px rgba(7,43,42,0.06)}
  .search-row{display:flex;gap:8px;}
  .search-input{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(7,43,42,0.08);font-size:16px}
  .btn{padding:10px 14px;border-radius:12px;border:2px solid var(--primary);color:var(--primary);background:white;font-weight:700;cursor:pointer}
  .btn.solid{background:var(--primary);color:white;border:0;}
  .tabs{display:flex;gap:10px;margin-top:10px;}
  .tab{padding:8px 14px;border-radius:999px;border:2px solid rgba(7,43,42,0.06);cursor:pointer;font-weight:700}
  .tab.active{background:var(--primary);color:white;border-color:var(--primary);}

  /* History */
  .history{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
  .chip{padding:8px 12px;border-radius:12px;background:rgba(6,182,196,0.12);color:var(--primary);font-weight:700;cursor:pointer}

  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:14px;}
  .card{background:white;border-radius:12px;overflow:hidden;border:1px solid rgba(7,43,42,0.06)}
  .thumb{width:100%;height:180px;object-fit:cover;}
  .meta{padding:10px;font-size:13px;color:var(--muted)}
  .actions{margin-top:6px;display:flex;gap:8px;flex-wrap:wrap}
  .smallBtn{padding:7px 10px;border-radius:10px;border:2px solid var(--primary);color:var(--primary);background:white;font-weight:700;cursor:pointer}

  @media(max-width:420px){.grid{grid-template-columns:repeat(1,1fr)}}

  /* Footer */
  footer.appfoot{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,0.9);
    backdrop-filter:blur(8px);padding:12px;border-top:1px solid rgba(7,43,42,0.06);
    display:flex;align-items:center;justify-content:space-between;z-index:20;height:80px;}
  .badge{background:var(--primary);color:white;padding:8px 10px;border-radius:10px;font-weight:800}

  /* Loader */
  #loader{padding:10px;color:var(--muted);text-align:center}
</style>
</head>
<body>
<div class="frame">
  <header class="appbar">
    <div class="logo">IS</div>
    <div style="flex:1">
      <div class="app-title">ImageSearchMan</div>
      <div class="app-sub">Images · Short clips · Quick preview</div>
    </div>
    <button id="clearHistory" class="btn">Clear</button>
  </header>

  <main class="content">
    <div class="hero">
      <div class="search-row">
        <input id="q" class="search-input" placeholder="खोजें — जैसे: 'Rahul Gandhi' " />
        <button id="searchBtn" class="btn solid">Search</button>
      </div>

      <div class="tabs">
        <button id="tabImages" class="tab active">Images</button>
        <button id="tabVideos" class="tab">Videos</button>
      </div>

      <div id="historyWrap" class="history"></div>
    </div>

    <!-- Images -->
    <div id="imagesArea">
      <div id="loader" style="display:none;">लोड कर रहे हैं…</div>
      <div id="grid" class="grid"></div>
      <div style="text-align:center;margin-top:10px">
        <button id="moreBtn" class="btn" style="display:none">और दिखाओ</button>
      </div>
    </div>

    <!-- Videos -->
    <div id="videosArea" style="display:none;margin-top:10px">
      <input id="videoInput" class="search-input" placeholder="YouTube / mp4 video URL" />
      <button id="previewVideo" class="btn" style="margin-top:10px">Preview</button>
      <div id="videoPreview" style="margin-top:10px"></div>
    </div>
  </main>

  <footer class="appfoot">
    <div>Powered by</div>
    <div class="badge">DDG Proxy</div>
  </footer>
</div>

<script>
/* ------------------- CORRECT PROXY URL ------------------- */
const PROXY_URL = "https://google-serp-api-bp7z.onrender.com";
/* --------------------------------------------------------- */

let qInput = document.getElementById("q");
let grid = document.getElementById("grid");
let loader = document.getElementById("loader");
let moreBtn = document.getElementById("moreBtn");

let offset = 0;
let currentQ = "";

/* ---------------- Tabs ---------------- */
document.getElementById("tabImages").onclick = () => {
  imagesArea.style.display = "block";
  videosArea.style.display = "none";
  tabImages.classList.add("active");
  tabVideos.classList.remove("active");
};

document.getElementById("tabVideos").onclick = () => {
  videosArea.style.display = "block";
  imagesArea.style.display = "none";
  tabVideos.classList.add("active");
  tabImages.classList.remove("active");
};

/* ---------------- Search ---------------- */
async function fetchImages(q, s = 0) {
  loader.style.display = "block";
  try {
    const url = `${PROXY_URL}/api/images?q=${encodeURIComponent(q)}&s=${s}`;
    const res = await fetch(url);
    const data = await res.json();
    loader.style.display = "none";
    return data;
  } catch (err) {
    loader.style.display = "none";
    alert("Server error (maybe waking up). फिर try करें।");
    throw err;
  }
}

function makeCard(item) {
  const div = document.createElement("div");
  div.className = "card";

  const img = item.image || item.thumbnail || "";

  div.innerHTML = `
    <img class="thumb" src="${img}" />
    <div class="meta">
      <div>${item.title || ""}</div>
      <div class="actions">
        <a class="smallBtn" href="${img}" download>Download</a>
        <a class="smallBtn" href="${item.url}" target="_blank">Open</a>
      </div>
    </div>
  `;
  return div;
}

async function doSearch() {
  const q = qInput.value.trim();
  if (!q) return;

  currentQ = q;
  offset = 0;
  grid.innerHTML = "";
  saveHistory(q);

  const data = await fetchImages(q, offset);

  if (!data || !data.results || data.results.length === 0) {
    grid.innerHTML = `<div style="padding:10px;color:gray">कोई चित्र नहीं मिला</div>`;
    moreBtn.style.display = "none";
    return;
  }

  data.results.forEach(r => grid.appendChild(makeCard(r)));
  moreBtn.style.display = data.results.length >= 100 ? "block" : "none";
}

document.getElementById("searchBtn").onclick = doSearch;
qInput.onkeydown = (e) => { if (e.key === "Enter") doSearch(); };

moreBtn.onclick = async () => {
  offset += 100;
  const data = await fetchImages(currentQ, offset);
  data.results.forEach(r => grid.appendChild(makeCard(r)));
};

/* ---------------- History ---------------- */
function saveHistory(q){
  let arr = JSON.parse(localStorage.getItem("ism_hist")||"[]");
  arr = arr.filter(x=>x!==q);
  arr.unshift(q);
  if(arr.length>20) arr=arr.slice(0,20);
  localStorage.setItem("ism_hist",JSON.stringify(arr));
  renderHistory();
}
function renderHistory(){
  let arr = JSON.parse(localStorage.getItem("ism_hist")||"[]");
  historyWrap.innerHTML = arr.map(h=>`<div class="chip" onclick="pickHistory('${h}')">${h}</div>`).join("");
}
function pickHistory(q){
  qInput.value = q;
  doSearch();
}
document.getElementById("clearHistory").onclick = ()=>{
  localStorage.removeItem("ism_hist");
  renderHistory();
};
renderHistory();

/* ---------------- Video Preview ---------------- */
document.getElementById("previewVideo").onclick = ()=>{
  const url = videoInput.value.trim();
  if (!url) return;

  if(url.includes("youtube.com") || url.includes("youtu.be")){
    const id = url.split("v=")[1]?.split("&")[0];
    videoPreview.innerHTML = `
      <iframe width="100%" height="260" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>
    `;
  }
  else if(url.endsWith(".mp4")){
    videoPreview.innerHTML = `
      <video controls style="width:100%"><source src="${url}" type="video/mp4"></video>
    `;
  } else {
    videoPreview.innerHTML = `<div>Cannot preview. <a href="${url}" target="_blank">Open</a></div>`;
  }
};
</script>
</body>
</html>
