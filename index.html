<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ImageSearchMan • 2025 Premium Edition</title>
<style>
  :root {
    --pri: #ff006e;
    --sec: #8338ec;
    --acc: #06ffa5;
    --grad: linear-gradient(135deg, #ff006e, #8338ec, #4f46e5);
    --glass: rgba(255,255,255,0.12);
    --border: rgba(255,255,255,0.18);
    --glow: 0 0 30px rgba(131,56,236,0.6);
    --text: rgba(255,255,255,0.95);
    --muted: rgba(255,255,255,0.6);
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body {
    font-family: system-ui, -apple-system, sans-serif;
    background: linear-gradient(-45deg, #0f0f23, #1a0033, #000428, #002d5f);
    background-size: 400% 400%;
    animation: bg 15s ease infinite;
    color: var(--text);
    min-height: 100dvh;
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
  @keyframes bg { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }

  body::before {
    content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
    background: radial-gradient(circle at 20% 30%, #ff006e18 1px, transparent 1px),
                radial-gradient(circle at 80% 70%, #06ffa518 1px, transparent 1px);
    background-size: 80px 80px;
    animation: float 30s linear infinite;
  }
  @keyframes float { from {transform:translate(0,0)} to {transform:translate(40px,-40px)} }

  .wrap { padding:16px; max-width:1100px; margin:auto; position:relative; z-index:2; }

  header { text-align:center; padding:30px 0 10px; }
  .logo {
    width:100px; height:100px; margin:auto auto 16px;
    background:var(--grad); border-radius:50%; display:grid; place-items:center;
    font-size:40px; font-weight:900; color:white; box-shadow:var(--glow);
    animation:pulse 4s infinite;
  }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }
  h1 { 
    font-size:34px; margin:16px 0 8px;
    background:linear-gradient(90deg,#06ffa5,#00d9ff,#8b5cf6);
    -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
  }
  .tagline { font-size:16px; opacity:0.9; }

  .card {
    background:var(--glass);
    backdrop-filter:blur(blur(20px));
    border:1px solid var(--border);
    border-radius:28px;
    padding:20px;
    margin:20px 0 30px;
    box-shadow:0 8px 32px rgba(0,0,0,0.4);
  }

  #q {
    width:100%;
    padding:18px 20px;
    border:none;
    border-radius:50px;
    background:rgba(255,255,255,0.15);
    color:white;
    font-size:17px;
    min-height:56px;
    margin-bottom:16px;
  }
  #q::placeholder { color:rgba(255,255,255,0.6); }
  #q:focus { outline:none; background:rgba(255,255,255,0.25); box-shadow:0 0 0 4px rgba(131,56,236,0.3); }

  .tabs {
    display:flex;
    gap:12px;
    justify-content:center;
    margin-bottom:20px;
  }
  .tab {
    padding:12px 36px;
    border-radius:50px;
    background:rgba(255,255,255,0.1);
    border:1px solid rgba(255,255,255,0.2);
    font-weight:600;
    min-width:130px;
    text-align:center;
    transition:0.3s;
    cursor:pointer;
  }
  .tab.active {
    background:var(--grad);
    box-shadow:var(--glow);
    transform:scale(1.05);
  }

  .center-btn {
    display:block;
    width:80%;
    max-width:320px;
    margin:20px auto 0;
    padding:16px 20px;
    border:none;
    border-radius:50px;
    background:var(--grad);
    color:white;
    font-size:18px;
    font-weight:700;
    box-shadow:var(--glow);
    cursor:pointer;
  }
  .center-btn:active { transform:scale(0.96); }

  /* History chips */
  .history {
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
    justify-content:center;
  }
  .chip {
    background:rgba(255,255,255,0.15);
    border:1px solid rgba(255,255,255,0.2);
    padding:8px 16px;
    border-radius:50px;
    font-size:14px;
    cursor:pointer;
    transition:0.3s;
  }
  .chip:hover { background:rgba(255,255,255,0.25); transform:scale(1.05); }

  .grid {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(150px,1fr));
    gap:16px;
    margin-top:20px;
  }
  .item {
    background:var(--glass);
    border-radius:20px;
    overflow:hidden;
    border:1px solid var(--border);
    box-shadow:0 4px 20px rgba(0,0,0,0.3);
  }
  .item img {
    width:100%; height:180px; object-fit:cover; transition:0.4s;
  }
  .item:hover img { transform:scale(1.12); }
  .info { padding:12px; font-size:14px; }
  .title { font-weight:600; margin-bottom:6px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .source { font-size:12px; color:var(--muted); margin-bottom:8px; }
  .actions { display:flex; gap:6px; }
  .act {
    flex:1; padding:9px; border:none; border-radius:12px;
    background:rgba(255,255,255,0.15); color:white; font-size:13px; font-weight:600; cursor:pointer;
  }
  .act:active { background:var(--acc); }

  #loader { text-align:center; padding:60px 20px; display:none; color:var(--muted); }
  .spin {
    width:60px; height:60px; border:5px solid rgba(255,255,255,0.2);
    border-top-color:var(--acc); border-radius:50%;
    animation:spin 1s linear infinite; margin:auto;
  }
  @keyframes spin { to{transform:rotate(360deg)} }

  #moreBtn {
    display:block; margin:40px auto; padding:16px 50px; font-size:18px;
    width:80%; max-width:320px;
  }

  /* Modal */
  .modal {
    position:fixed; inset:0; background:#000c; display:none; place-items:center; z-index:999;
  }
  .modal.show { display:grid; }
  .modalCard {
    background:var(--glass); backdrop-filter:blur(20px);
    border:1px solid var(--border); border-radius:24px; padding:20px;
    max-width:95%; max-height:95%; border-radius:24px; text-align:center;
  }
  .modalImg { max-width:100%; max-height:70vh; border-radius:16px; }

  footer { text-align:center; padding:rgba(255,255,255,0.7); padding:40px 20px; opacity:0.9; font-size:14px; }
  .badge {
    background:var(--grad); padding:12px 32px; border-radius:50px;
    display:inline-block; box-shadow:var(--glow); font-weight:700;
  }

  /* Video panel (hidden by default) */
  #videosArea { display:none; margin-top:20px; }
  .video-input { width:100%; padding:16px; border-radius:16px; background:rgba(255,255,255,0.15); border:none; color:white; margin-bottom:12px; }
  .quick-links { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="logo">IS</div>
    <h1>ImageSearchMan</h1>
    <p class="tagline">सबसे तेज़ और प्रीमियम DDG सर्च • 2025 एडिशन</p>
  </header>

  <div class="card">
    <input type="text" id="q" placeholder="यहाँ सर्च करें... जैसे: बिहार चुनाव, नरेंद्र मोदी, विराट कोहली..." autocomplete="off">

    <div class="tabs">
      <div class="tab active" id="tabImages">Images</div>
      <div class="tab" id="tabVideos">Videos</div>
    </div>

    <!-- History Chips -->
    <div class="history" id="historyWrap"></div>

    <button class="center-btn" id="searchBtn">Search</button>
    <button class="center-btn" id="clearHistoryBtn" style="margin-top:12px; background:#ff006e33;">Clear History</button>
  </div>

  <!-- Images Area -->
  <div id="imagesArea">
    <div id="loader"><div class="spin"></div><p>इमेजेस लोड हो रही हैं...</p></div>
    <div class="grid" id="grid"></div>
    <button class="center-btn" id="moreBtn" style="display:none">और दिखाएं</button>
  </div>

  <!-- Videos Area -->
  <div id="videosArea">
    <input type="text" class="video-input" id="videoUrl" placeholder="यहाँ YouTube या MP4 लिंक डालें...">
    <button class="center-btn" id="previewBtn">Preview Video</button>
    <div class="quick-links" style="margin-top:20px">
      <button class="act" id="openDuck">DuckDuckGo Videos</button>
      <button class="act" id="openYou">YouTube</button>
      <button class="act" id="openBing">Bing Videos</button>
    </div>
    <div id="videoPreview" style="margin-top:20px"></div>
  </div>

  <footer>
    <div class="badge">Powered by DDG Proxy + Render</div>
    <p style="margin-top:12px">© 2025 ImageSearchMan • Premium Mobile Edition</p>
  </footer>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modalCard">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
      <h3>Preview</h3>
      <button class="act" id="closeModal" style="padding:8px 16px;">Close</button>
    </div>
    <div id="modalBody"></div>
    <div id="modalMeta" style="margin-top:16px;"></div>
  </div>
</div>

<script>
// Render Proxy URL (Same as yours)
const PROXY = "https://google-serp-api-bp7z.onrender.com";
let q = "";

// DOM Elements
const qInput = document.getElementById('q');
const searchBtn = document.getElementById('searchBtn');
const tabImages = document.getElementById('tabImages');
const tabVideos = document.getElementById('tabVideos');
const grid = document.getElementById('grid');
const loader = document.getElementById('loader');
const moreBtn = document.getElementById('moreBtn');
const historyWrap = document.getElementById('historyWrap');
const clearHistoryBtn = document.getElementById('clearHistoryBtn');
const imagesArea = document.getElementById('imagesArea');
const videosArea = document.getElementById('videosArea');
const videoUrl = document.getElementById('videoUrl');
const previewBtn = document.getElementById('previewBtn');
const videoPreview = document.getElementById('videoPreview');
const modal = document.getElementById('modal');
const modalBody = document.getElementById('modalBody');
const modalMeta = document.getElementById('modalMeta');
const closeModal = document.getElementById('closeModal');

// Wake up Render
fetch(PROXY).catch(()=>{});

// History Functions
function loadHistory() {
  const hist = JSON.parse(localStorage.getItem('ism2025_hist') || '[]');
  historyWrap.innerHTML = hist.map(term => `<div class="chip" onclick="searchTerm('${term}')">${term}</div>`).join('');
}
function saveHistory(term) {
  if (!term) return;
  let hist = JSON.parse(localStorage.getItem('ism2025_hist') || '[]');
  hist = hist.filter(x => x !== term);
  hist.unshift(term);
  if (hist.length > 15) hist.pop();
  localStorage.setItem('ism2025_hist', JSON.stringify(hist));
  loadHistory();
}
function searchTerm(term) {
  qInput.value = term;
  doSearch();
}
clearHistoryBtn.onclick = () => {
  localStorage.removeItem('ism2025_hist');
  historyWrap.innerHTML = '';
};

// Tab Switch
tabImages.onclick = () => {
  tabImages.classList.add('active'); tabVideos.classList.remove('active');
  imagesArea.style.display = 'block'; videosArea.style.display = 'none';
};
tabVideos.onclick = () => {
  tabVideos.classList.add('active'); tabImages.classList.remove('active');
  imagesArea.style.display = 'none'; videosArea.style.display = 'block';
};

// Search Function
async function doSearch(append = false) {
  const term = qInput.value.trim();
  if (!term) return alert("कुछ तो लिख भाई!");
  if (!append) { q = term; grid.innerHTML = ''; saveHistory(term); }
  loader.style.display = 'block';

  try {
    const res = await fetch(`${PROXY}/api/images?q=${encodeURIComponent(q)}`);
    const data = await res.json();
    loader.style.display = 'none';

    if (data.results && data.results.length) {
      data.results.forEach(r => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="${r.thumbnail || r.image}" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=Error'">
          <div class="info">
            <div class="title">${r.title || 'No title'}</div>
            <div class="source">${r.source || 'DuckDuckGo'}</div>
            <div class="actions">
              <button class="act" onclick="preview('${r.image}')">Preview</button>
              <a href="${r.image}" download class="act" target="_blank">Full Size</a>
              <button class="act" onclick="copyLink('${r.image}')">Copy</button>
            </div>
          </div>`;
        grid.appendChild(div);
      });
      // DDG Scrape library simple search me pagination difficult hota hai, filhal 'Show More' ko hide karte hain
      // agar backend me pagination implement hoga tabhi ye enable hoga. 
      // Abhi ye library ek baar me kaafi result deti hai.
      moreBtn.style.display = 'none'; 
    } else {
      if(!append) grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#ff6b6b">कोई इमेज नहीं मिली</div>';
    }
  } catch (e) {
    loader.style.display = 'none';
    console.error(e);
    alert('Server सो रहा है या error है। 10-20 सेकंड बाद फिर ट्राई करें।');
  }
}

// Events
searchBtn.onclick = () => doSearch();
qInput.addEventListener('keypress', e => { if(e.key==='Enter') doSearch(); });

// Preview Modal
function preview(src) {
  modalBody.innerHTML = `<img class="modalImg" src="${src}" loading="lazy">`;
  modalMeta.innerHTML = `<a href="${src}" target="_blank" class="act" style="display:inline-block;margin:8px;">Open Full</a>`;
  modal.classList.add('show');
}
closeModal.onclick = () => modal.classList.remove('show');
modal.onclick = e => { if(e.target === modal) modal.classList.remove('show'); };

function copyLink(link) {
  navigator.clipboard.writeText(link).then(() => alert('लिंक कॉपी हो गया!'));
}

// Video Preview
previewBtn.onclick = () => {
  const url = videoUrl.value.trim();
  if (!url) return alert('वीडियो URL डालो भाई');
  
  const yt = url.match(/(?:v=|\/embed\/|\.be\/)([A-Za-z0-9_-]{11})/);
  if (yt) {
    const id = yt[1];
    videoPreview.innerHTML = `
      <img src="https://img.youtube.com/vi/${id}/hqdefault.jpg" style="width:100%;border-radius:16px;">
      <div style="margin-top:12px;display:flex;gap:12px;justify-content:center;">
        <button class="act" onclick="window.open('https://youtube.com/watch?v=${id}')">YouTube पर खोलें</button>
        <button class="act" onclick="embedYT('${id}')">यहाँ देखें</button>
      </div>`;
  } else if (url.includes('.mp4')) {
    videoPreview.innerHTML = `<video controls style="width:100%;border-radius:16px;"><source src="${url}"></video>`;
  } else {
    videoPreview.innerHTML = `<p>प्रीव्यू नहीं हो पाया। <a href="${url}" target="_blank">यहाँ क्लिक करें</a></p>`;
  }
};

function embedYT(id) {
  modalBody.innerHTML = `<iframe width="100%" height="400" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen style="border-radius:16px;"></iframe>`;
  modal.classList.add('show');
}

// Quick Video Links
document.getElementById('openDuck').onclick = () => openVideoSite('duckduckgo');
document.getElementById('openYou').onclick = () => openVideoSite('youtube');
document.getElementById('openBing').onclick = () => openVideoSite('bing');

function openVideoSite(site) {
  const query = encodeURIComponent(q || qInput.value.trim());
  if (!query) return alert('पहले कुछ सर्च करो');
  const urls = {
    duckduckgo: `https://duckduckgo.com/?q=${query}&iax=videos&ia=videos`,
    youtube: `https://youtube.com/results?search_query=${query}`,
    bing: `https://bing.com/videos/search?q=${query}`
  };
  window.open(urls[site], '_blank');
}

// Init
loadHistory();
qInput.focus();
</script>
</body>
</html>
