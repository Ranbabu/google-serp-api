<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ImageSearchMan — DDG Proxy</title>

<style>
  :root{
    --bg:#eef6ff;
    --card:#ffffff;
    --accent:#0f172a;
    --primary:#009dff;
    --pill:#dff3ff;
  }
  body{
    margin:0;
    background:var(--bg);
    font-family:system-ui,Segoe UI,Roboto;
    color:var(--accent);
  }
  .topbar{
    position:fixed;
    top:0; left:0; right:0;
    background:white;
    padding:14px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 6px rgba(0,0,0,0.06);
    z-index:1000;
  }
  .logo{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:20px;
    font-weight:700;
  }
  .logo-box{
    width:42px;height:42px;border-radius:10px;
    background:#10b981;
    color:white;
    display:flex;align-items:center;justify-content:center;
    font-size:20px;font-weight:700;
  }
  .clear-btn{
    padding:8px 14px;border-radius:10px;
    border:2px solid var(--primary);
    color:var(--primary);
    background:white;
    font-weight:600;
  }
  .wrap{
    margin-top:90px;
    padding:18px;
  }
  .search-box{
    background:white;
    padding:14px;
    border-radius:16px;
    box-shadow:0 2px 8px rgba(0,0,0,0.06);
  }
  .search-row{
    display:flex;gap:10px;
  }
  input{
    flex:1;
    padding:12px;
    border-radius:10px;
    border:1px solid #cbd5e1;
    font-size:17px;
  }
  .search-btn{
    background:var(--primary);
    color:white;
    border:0;
    padding:12px 16px;
    border-radius:12px;
    font-size:16px;
    font-weight:700;
  }

  .tabs{
    margin-top:14px;
    display:flex;
    gap:10px;
  }
  .tab{
    padding:10px 16px;
    border-radius:20px;
    background:#f1f5f9;
    font-weight:600;
    cursor:pointer;
  }
  .tab.active{ background:#009dff; color:white; }

  .history{ margin-top:14px;}
  .h-btn{
    display:inline-block;
    background:var(--pill);
    padding:10px 14px;
    border-radius:14px;
    margin:4px 4px;
    font-weight:600;
    cursor:pointer;
  }

  .grid{
    margin-top:20px;
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:14px;
  }
  .card{
    background:white;border-radius:12px;overflow:hidden;
    box-shadow:0 2px 8px rgba(0,0,0,0.07);
  }
  .thumb{
    width:100%;height:160px;object-fit:cover;
  }
  .info{ padding:10px;font-size:14px;color:#555; }

  .footer{
    margin-top:40px;
    text-align:center;
    color:#777;
    padding-bottom:40px;
  }
  .proxy-tag{
    background:var(--primary);
    padding:8px 18px;
    color:white;
    border-radius:14px;
    font-weight:bold;
  }
</style>
</head>

<body>

<div class="topbar">
  <div class="logo">
    <div class="logo-box">IS</div>
    ImageSearchMan
  </div>
  <button class="clear-btn" onclick="localStorage.clear();location.reload()">Clear</button>
</div>

<div class="wrap">
  <div class="search-box">

    <div class="search-row">
      <input id="q" placeholder="खोजें — जैसे: 'प्रधानमंत्री मोदी' " />
      <button id="search" class="search-btn">Search</button>
    </div>

    <div class="tabs">
      <div id="tabImg" class="tab active">Images</div>
      <div id="tabVid" class="tab">Videos</div>
    </div>

    <div id="history" class="history"></div>
  </div>

  <div id="loader" style="display:none;margin-top:20px;text-align:center;color:#777;">लोड हो रहा है…</div>

  <div id="grid" class="grid"></div>

</div>

<div class="footer">
  Powered by <span class="proxy-tag">DDG Proxy</span><br>
  © ImageSearchMan — Render Proxy Enabled
</div>

<script>
/* ------------------------------------
   CORRECT WORKING PROXY URL
--------------------------------------*/
const PROXY_URL = "https://google-serp-api-bp7z.onrender.com";

/* DOM */
const qInput = document.getElementById("q");
const grid = document.getElementById("grid");
const loader = document.getElementById("loader");
const historyBox = document.getElementById("history");

let mode = "img";
let currentQ = "";

/* HISTORY */
function saveHist(q){
  let h = JSON.parse(localStorage.getItem("hist")||"[]");
  h = h.filter(x=>x!==q);
  h.unshift(q);
  if(h.length>10) h = h.slice(0,10);
  localStorage.setItem("hist", JSON.stringify(h));
  renderHist();
}
function renderHist(){
  let h = JSON.parse(localStorage.getItem("hist")||"[]");
  historyBox.innerHTML = h.map(x=>`<div class="h-btn" onclick="setHist('${x}')">${x}</div>`).join("");
}
function setHist(x){ qInput.value=x; searchNow(); }

/* FETCH IMAGES */
async function fetchImages(q){
  const url = `${PROXY_URL}/api/images?q=${encodeURIComponent(q)}&s=0`;
  const res = await fetch(url);
  return res.json();
}

/* VIDEO FETCH (simple links) */
async function fetchVideos(q){
  return [
    {title:`${q} — YouTube`, thumb:`https://img.youtube.com/vi/dQw4w9WgXcQ/0.jpg`, link:`https://www.youtube.com/results?search_query=${q}`},
    {title:`${q} — DuckDuckGo`, thumb:`https://duckduckgo.com/assets/logo_header.v108.png`, link:`https://duckduckgo.com/?q=${q}&ia=videos`}
  ];
}

/* SEARCH */
async function searchNow(){
  const q = qInput.value.trim();
  if(!q) return alert("कोई शब्द डालें!");
  
  currentQ = q;
  grid.innerHTML = "";
  loader.style.display = "block";
  
  saveHist(q);

  if(mode === "img"){
    try{
      let data = await fetchImages(q);
      loader.style.display = "none";

      if(!data.results || data.results.length===0){
        grid.innerHTML = "<div style='grid-column:1/-1;color:#777'>कोई चित्र नहीं मिला</div>";
        return;
      }

      data.results.forEach(it=>{
        grid.innerHTML += `
          <div class="card" onclick="window.open('${it.url}','_blank')">
            <img class="thumb" src="${it.image||it.thumbnail}" />
            <div class="info">${it.title||''}</div>
          </div>`;
      });

    }catch(e){
      loader.style.display="none";
      alert("Server error (maybe waking up). फिर try करें।");
    }
  }

  if(mode === "vid"){
    let vids = await fetchVideos(q);
    loader.style.display="none";

    vids.forEach(v=>{
      grid.innerHTML += `
        <div class="card" onclick="window.open('${v.link}','_blank')">
          <img class="thumb" src="${v.thumb}" />
          <div class="info">${v.title}</div>
        </div>`;
    });
  }
}

/* EVENTS */
document.getElementById("search").onclick = searchNow;

document.getElementById("tabImg").onclick = ()=>{
  mode="img";
  tabImg.classList.add("active");
  tabVid.classList.remove("active");
};
document.getElementById("tabVid").onclick = ()=>{
  mode="vid";
  tabVid.classList.add("active");
  tabImg.classList.remove("active");
};

renderHist();
</script>

</body>
</html>
